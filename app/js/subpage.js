"use strict";function renderView(t){var e=document.getElementById(t.templateId).textContent,a=Handlebars.compile(e),n=t.data,s=document.getElementById(t.targetId),r=a(n);s.innerHTML=r}var offersList={};offersList={totalPages:null,currentPage:1,baseUrl:"http://camp.efigence.com/camp/api/places?page=",buttonsLimit:10,activeButtonIndex:0,init:function(){this.getData().done(function(t){this.totalPages=t.total_pages,this.renderOffersList(t),this.showPaginationButtons(),this.changePaginationClasses(),this.addPaginationListeners();var e=document.getElementsByClassName("pagination__wrap")[0];e.scrollIntoViewIfNeeded(!0)}).error(function(t){this.renderOffersError(t)})},getData:function(){return $.ajax({context:offersList,method:"GET",url:this.baseUrl+this.currentPage})},renderOffersList:function(t){renderView({templateId:"offers-template",data:t,targetId:"offers"})},renderOffersError:function(t){renderView({templateId:"offers-template--error",data:t,targetId:"offers"})},showPaginationButtons:function(){for(var t=Math.min(this.totalPages,this.buttonsLimit),e=document.getElementsByClassName("buttons-next-prev__wrap"),a=Array.apply(null,new Array(t)).map(Number.prototype.valueOf,0),n=0,s=e.length;s>n;n++)e[n].classList.remove("hidden");renderView({templateId:"pagination-button",data:{buttonsCount:a},targetId:"pagination__buttons-list"})},goToPage:function(t){return this.checkPageRange(t)?void this.getData().done(function(t){this.renderOffersList(t),this.renumberButtons(),this.changePaginationClasses()}).error(function(t){this.renderOffersError(t)}):!1},checkPageRange:function(t){var e;if(t.page&&t.offset||!t.page&&!t.offset)return!1;switch(e=t.page||this.currentPage+t.offset,!0){case e===this.currentPage:return!1;case e>this.totalPages:return!1;case 1>e:return!1;default:return this.currentPage=e,!0}},changePaginationClasses:function(){for(var t,e=document.getElementsByClassName("pagination__button"),a=document.getElementsByClassName("buttons-next-prev__wrap")[0],n=document.getElementsByClassName("buttons-next-prev__wrap")[1],s="buttons-next-prev__wrap--inactive",r=0,i=e.length;i>r;r++)e[r].classList.remove("pagination__button--active");t=(this.currentPage-1)%this.buttonsLimit,e[t].classList.add("pagination__button--active"),1===this.currentPage?a.classList.add(s):this.currentPage===this.totalPages?n.classList.add(s):(a.classList.remove(s),n.classList.remove(s))},renumberButtons:function(){var t=document.getElementsByClassName("pagination__button"),e=((this.currentPage-1)%this.buttonsLimit,t.length);if(this.currentPage!=e+1)return console.log("nie zadzialam"),!1;var a=0;a=Math.min(this.totalPages-this.currentPage+1,this.buttonsLimit),console.log("OFFSET: "+a);for(var n=0;e>n;n++)t[n].textContent=parseInt(t[n].dataset.page)+a},addPaginationListeners:function(){var t=document.getElementById("pagination__buttons-list"),e=document.getElementsByClassName("buttons-next-prev__wrap")[0],a=document.getElementsByClassName("buttons-next-prev__wrap")[1],n=this;t.addEventListener("click",function(t){n.goToPage({page:parseInt(t.target.dataset.page)})}),e.addEventListener("click",function(t){n.goToPage({offset:-1})}),a.addEventListener("click",function(t){n.goToPage({offset:1})})}},offersList.init(),function(){Handlebars.registerHelper("times",function(t,e){var a=new Array(t+1),n=a.join(e);return n}),Handlebars.registerHelper("increase",function(t,e){return t+e}),Handlebars.registerHelper("scoreDescription",function(t){var e="";switch(!0){case 3>=t:e="Fatalny";break;case t>3&&5>=t:e="Nie najlepszy";break;case t>5&&6.4>t:e="Przeciętny";break;case t>5&&6.5>=t:e="Przeciętny";break;case t>6.5&&8>=t:e="Bardzo dobry";break;case t>8&&9>t:e="Znakomity";break;default:e="Wybitny"}return e+" "+t}),Handlebars.registerHelper("isEqual",function(t,e){return t===e})}(),function(){var t,e,a;t={baseUrl:"//camp.efigence.com/camp/api/places?page=",getData:function(t){var e=this;return $.ajax({method:"GET",crossDomain:!0,url:e.baseUrl+t})}},a={totalPages:null,currentPage:1,maxNumberOfButtons:10,numberOfVisibleButtons:null,visiblePages:[],init:function(){var a=this;t.getData().done(function(t){a.totalPages=t.total_pages,a.numberOfVisibleButtons=Math.min(a.totalPages,a.maxNumberOfButtons);for(var n=0;n<a.numberOfVisibleButtons;n++)a.visiblePages.push(n+1);e.updateView({pageNumber:1,activeButtonIndex:0}),e.renderPagination(a.numberOfVisibleButtons),a.addListeners()})},updateVisiblePages:function(){var t,e=this.numberOfVisibleButtons,a=document.getElementsByClassName("pagination__button");if(this.visiblePages.indexOf(this.currentPage)>-1)return!1;t=this.visiblePages[0]>this.currentPage?Math.max(-this.currentPage,-e):Math.min(e,this.totalPages-this.currentPage+1);for(var n=0,s=e;s>n;n++)this.visiblePages[n]=this.visiblePages[n]+t,a[n].textContent=this.visiblePages[n],a[n].dataset.page=this.visiblePages[n]},updateStatus:function(t){var a,n;if(t.page&&t.offset||!t.page&&!t.offset)return!1;switch(a=t.page||this.currentPage+t.offset,!0){case a===this.currentPage:return!1;case a>this.totalPages:return!1;case 1>a:return!1;default:this.currentPage=a,this.updateVisiblePages(),n=this.visiblePages.indexOf(a),e.updateView({pageNumber:a,activeButtonIndex:n,totalPages:this.totalPages})}},addListeners:function(){var t=document.getElementById("pagination__buttons-list"),e=document.getElementsByClassName("buttons-next-prev__wrap")[0],a=document.getElementsByClassName("buttons-next-prev__wrap")[1],n=this;t.addEventListener("click",function(t){n.updateStatus({page:parseInt(t.target.dataset.page)})}),e.addEventListener("click",function(t){n.updateStatus({offset:-1})}),a.addEventListener("click",function(t){n.updateStatus({offset:1})})}},e={renderTemplate:function(t){var e=document.getElementById(t.templateId).textContent,a=Handlebars.compile(e),n=t.data,s=document.getElementById(t.targetId),r=a(n);s.innerHTML=r},renderOffersList:function(t){this.renderTemplate({templateId:"offers-template",data:t,targetId:"offers"})},renderOffersError:function(t){this.renderTemplate({templateId:"offers-template--error",data:t,targetId:"offers"})},renderPagination:function(t){var e,a;e=document.getElementsByClassName("buttons-next-prev__wrap"),a=Array.apply(null,new Array(t)).map(Number.prototype.valueOf,0);for(var n=0;2>n;n++)e[n].classList.remove("hidden");this.renderTemplate({templateId:"pagination-button",data:{buttonsCount:a},targetId:"pagination__buttons-list"})},updateView:function(e){var a=this;t.getData(e.pageNumber).done(function(t){a.renderOffersList(t),a.markActiveButton(e.activeButtonIndex),a.showHideNavButtons(e)}).error(function(t){a.renferOffersError(t)})},markActiveButton:function(t){for(var e="pagination__button--active",a=document.getElementsByClassName(e),n=document.getElementsByClassName("pagination__button"),s=0,r=a.length;r>s;s++)a[s].classList.remove(e);n[t].classList.add(e)},showHideNavButtons:function(t){var e=document.getElementsByClassName("buttons-next-prev__wrap"),a="buttons-next-prev__wrap--inactive",n=document.getElementsByClassName(a);if(t.pageNumber>1&&t.pageNumber<t.totalPages)for(var s=0,r=n.length;r>s;s++)n[s].classList.remove(a);else 1===t.pageNumber?e[0].classList.add(a):e[1].classList.add(a)}},a.init()}(),function(){var t=document.querySelector(".hamburger-button"),e=document.querySelector(".main-menu"),a="main-menu--collapsed",n="animated--scaleIn";animationCollapse="animated--scaleOut",animationDelay=300,t.addEventListener("click",function(){e.classList.contains(a)?(e.classList.toggle(a),e.classList.toggle(n)):(e.classList.toggle(n),e.classList.toggle(animationCollapse),setTimeout(function(){e.classList.toggle(a),e.classList.toggle(animationCollapse)},animationDelay)),t.classList.toggle("fa-bars"),t.classList.toggle("fa-times")})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXguanMiLCJoYW5kbGViYXJzLWhlbHBlcnMuanMiLCJtYWluLXN1YnBhZ2UuanMiLCJ0b29nbGUtbWVudS5qcyJdLCJuYW1lcyI6WyJyZW5kZXJWaWV3Iiwib3B0aW9ucyIsInNvdXJjZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0ZW1wbGF0ZUlkIiwidGV4dENvbnRlbnQiLCJ0ZW1wbGF0ZSIsIkhhbmRsZWJhcnMiLCJjb21waWxlIiwiY29udGV4dCIsImRhdGEiLCJ0YXJnZXQiLCJ0YXJnZXRJZCIsImh0bWwiLCJpbm5lckhUTUwiLCJvZmZlcnNMaXN0IiwidG90YWxQYWdlcyIsImN1cnJlbnRQYWdlIiwiYmFzZVVybCIsImJ1dHRvbnNMaW1pdCIsImFjdGl2ZUJ1dHRvbkluZGV4IiwiaW5pdCIsInRoaXMiLCJnZXREYXRhIiwiZG9uZSIsInRvdGFsX3BhZ2VzIiwicmVuZGVyT2ZmZXJzTGlzdCIsInNob3dQYWdpbmF0aW9uQnV0dG9ucyIsImNoYW5nZVBhZ2luYXRpb25DbGFzc2VzIiwiYWRkUGFnaW5hdGlvbkxpc3RlbmVycyIsIngiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwic2Nyb2xsSW50b1ZpZXdJZk5lZWRlZCIsImVycm9yIiwicmVuZGVyT2ZmZXJzRXJyb3IiLCIkIiwiYWpheCIsIm1ldGhvZCIsInVybCIsIm1heEJ1dHRvbnMiLCJNYXRoIiwibWluIiwiYnV0dG9uc05leHRQcmV2IiwidGVtcEFycmF5IiwiQXJyYXkiLCJhcHBseSIsIm1hcCIsIk51bWJlciIsInByb3RvdHlwZSIsInZhbHVlT2YiLCJpIiwibCIsImxlbmd0aCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImJ1dHRvbnNDb3VudCIsImdvVG9QYWdlIiwiY2hlY2tQYWdlUmFuZ2UiLCJyZW51bWJlckJ1dHRvbnMiLCJ0YXJnZXRQYWdlIiwicGFnZSIsIm9mZnNldCIsInBhZ2luYXRpb25CdXR0b25zIiwiYnV0dG9uUHJldiIsImJ1dHRvbk5leHQiLCJjbGFzc0luYWN0aXZlIiwiYWRkIiwiY29uc29sZSIsImxvZyIsInBhcnNlSW50IiwiZGF0YXNldCIsInBhZ2luYXRpb25CdXR0b25zTGlzdCIsInRoYXQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInJlZ2lzdGVySGVscGVyIiwibnVtYmVyIiwiZWxlbWVudCIsImFyciIsInJlc3VsdCIsImpvaW4iLCJ2YWx1ZSIsInN0ZXAiLCJzY29yZSIsImRlc2NyaXB0aW9uIiwicHJpY2VSZWd1bGFyIiwicHJpY2VQcm9tbyIsIm9mZmVyc0RhdGEiLCJvZmZlcnNWaWV3Iiwib2ZmZXJzU3RhdGUiLCJwYWdlTnVtYmVyIiwiY3Jvc3NEb21haW4iLCJtYXhOdW1iZXJPZkJ1dHRvbnMiLCJudW1iZXJPZlZpc2libGVCdXR0b25zIiwidmlzaWJsZVBhZ2VzIiwicHVzaCIsInVwZGF0ZVZpZXciLCJyZW5kZXJQYWdpbmF0aW9uIiwiYWRkTGlzdGVuZXJzIiwidXBkYXRlVmlzaWJsZVBhZ2VzIiwiYnV0dG9ucyIsImluZGV4T2YiLCJtYXgiLCJ1cGRhdGVTdGF0dXMiLCJhY3RpdmVCdXR0b24iLCJyZW5kZXJUZW1wbGF0ZSIsInRlbXBsYXRlQXJyYXkiLCJtYXJrQWN0aXZlQnV0dG9uIiwic2hvd0hpZGVOYXZCdXR0b25zIiwicmVuZmVyT2ZmZXJzRXJyb3IiLCJidXR0b25JbmRleCIsImNsYXNzQWN0aXZlIiwiYnV0dG9uc0FjdGl2ZSIsImJ1dHRvbnNOZXhQcmV2SW5hY3RpdmUiLCJidG4iLCJxdWVyeVNlbGVjdG9yIiwibWFpbk1lbnUiLCJjb2xsYXBzZUNsYXNzIiwiYW5pbWF0aW9uRXhwYW5kIiwiYW5pbWF0aW9uQ29sbGFwc2UiLCJhbmltYXRpb25EZWxheSIsImNvbnRhaW5zIiwidG9nZ2xlIiwic2V0VGltZW91dCJdLCJtYXBwaW5ncyI6IkFBQ0EsWUFxS0EsU0FBQUEsWUFBQUMsR0FDQSxHQUFBQyxHQUFBQyxTQUFBQyxlQUFBSCxFQUFBSSxZQUFBQyxZQUNBQyxFQUFBQyxXQUFBQyxRQUFBUCxHQUNBUSxFQUFB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LEVBQUE3RCxVQUFBcUUsT0FBQSxXQUNBUixFQUFBN0QsVUFBQXFFLE9BQUEiLCJmaWxlIjoic3VicGFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsqL1xuJ3VzZSBzdHJpY3QnO1xudmFyIG9mZmVyc0xpc3QgPSB7fTtcblxub2ZmZXJzTGlzdCA9IHtcbiAgICB0b3RhbFBhZ2VzOiBudWxsLFxuICAgIGN1cnJlbnRQYWdlOiAxLFxuICAgIGJhc2VVcmw6ICdodHRwOi8vY2FtcC5lZmlnZW5jZS5jb20vY2FtcC9hcGkvcGxhY2VzP3BhZ2U9JyxcbiAgICBidXR0b25zTGltaXQ6IDEwLFxuICAgIGFjdGl2ZUJ1dHRvbkluZGV4OiAwLFxuICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nZXREYXRhKClcbiAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3RhbFBhZ2VzID0gZGF0YS50b3RhbF9wYWdlcztcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlck9mZmVyc0xpc3QoZGF0YSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93UGFnaW5hdGlvbkJ1dHRvbnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVBhZ2luYXRpb25DbGFzc2VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRQYWdpbmF0aW9uTGlzdGVuZXJzKCk7XG4gICAgICAgICAgICAgICAgdmFyIHggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYWdpbmF0aW9uX193cmFwJylbMF1cbnguc2Nyb2xsSW50b1ZpZXdJZk5lZWRlZCh0cnVlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlck9mZmVyc0Vycm9yKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcbiAgICBnZXREYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICAgICAgY29udGV4dDogb2ZmZXJzTGlzdCxcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6IHRoaXMuYmFzZVVybCArIHRoaXMuY3VycmVudFBhZ2VcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICByZW5kZXJPZmZlcnNMaXN0OiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZW5kZXJWaWV3KHtcbiAgICAgICAgICAgIHRlbXBsYXRlSWQ6ICdvZmZlcnMtdGVtcGxhdGUnLFxuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIHRhcmdldElkOiAnb2ZmZXJzJ1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIHJlbmRlck9mZmVyc0Vycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZW5kZXJWaWV3KHtcbiAgICAgICAgICAgIHRlbXBsYXRlSWQ6ICdvZmZlcnMtdGVtcGxhdGUtLWVycm9yJyxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICB0YXJnZXRJZDogJ29mZmVycydcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBzaG93UGFnaW5hdGlvbkJ1dHRvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1heEJ1dHRvbnMgPSBNYXRoLm1pbih0aGlzLnRvdGFsUGFnZXMsIHRoaXMuYnV0dG9uc0xpbWl0KSxcbiAgICAgICAgYnV0dG9uc05leHRQcmV2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYnV0dG9ucy1uZXh0LXByZXZfX3dyYXAnKSxcbiAgICAgICAgdGVtcEFycmF5ID0gQXJyYXkuYXBwbHkobnVsbCwgbmV3IEFycmF5KG1heEJ1dHRvbnMpKS5tYXAoTnVtYmVyLnByb3RvdHlwZS52YWx1ZU9mLCAwKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGJ1dHRvbnNOZXh0UHJldi5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGJ1dHRvbnNOZXh0UHJldltpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlbmRlclZpZXcoe1xuICAgICAgICAgICAgdGVtcGxhdGVJZDogJ3BhZ2luYXRpb24tYnV0dG9uJyxcbiAgICAgICAgICAgIGRhdGE6IHtidXR0b25zQ291bnQ6IHRlbXBBcnJheX0sXG4gICAgICAgICAgICB0YXJnZXRJZDogJ3BhZ2luYXRpb25fX2J1dHRvbnMtbGlzdCdcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBnb1RvUGFnZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsgLyp7cGFnZTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcn0qL1xuICAgICAgICBpZiAoIXRoaXMuY2hlY2tQYWdlUmFuZ2Uob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RGF0YSgpXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJPZmZlcnNMaXN0KGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbnVtYmVyQnV0dG9ucygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVBhZ2luYXRpb25DbGFzc2VzKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJPZmZlcnNFcnJvcihkYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgY2hlY2tQYWdlUmFuZ2U6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciB0YXJnZXRQYWdlO1xuXG4gICAgICAgIGlmICgob3B0aW9ucy5wYWdlICYmIG9wdGlvbnMub2Zmc2V0KSB8fCAoIW9wdGlvbnMucGFnZSAmJiAhb3B0aW9ucy5vZmZzZXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0YXJnZXRQYWdlID0gb3B0aW9ucy5wYWdlIHx8IHRoaXMuY3VycmVudFBhZ2UgKyBvcHRpb25zLm9mZnNldDtcblxuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2UgKHRhcmdldFBhZ2UgPT09IHRoaXMuY3VycmVudFBhZ2UpOlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGNhc2UgKHRhcmdldFBhZ2UgPiB0aGlzLnRvdGFsUGFnZXMpOlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGNhc2UgKHRhcmdldFBhZ2UgPCAxKTpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0YXJnZXRQYWdlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBjaGFuZ2VQYWdpbmF0aW9uQ2xhc3NlczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFnaW5hdGlvbkJ1dHRvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYWdpbmF0aW9uX19idXR0b24nKSxcbiAgICAgICAgYnV0dG9uUHJldiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2J1dHRvbnMtbmV4dC1wcmV2X193cmFwJylbMF0sXG4gICAgICAgIGJ1dHRvbk5leHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdidXR0b25zLW5leHQtcHJldl9fd3JhcCcpWzFdLFxuICAgICAgICBjbGFzc0luYWN0aXZlID0gJ2J1dHRvbnMtbmV4dC1wcmV2X193cmFwLS1pbmFjdGl2ZScsXG4gICAgICAgIGFjdGl2ZUJ1dHRvbkluZGV4O1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFnaW5hdGlvbkJ1dHRvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICBwYWdpbmF0aW9uQnV0dG9uc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdwYWdpbmF0aW9uX19idXR0b24tLWFjdGl2ZScpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGFjdGl2ZUJ1dHRvbkluZGV4ID0gKHRoaXMuY3VycmVudFBhZ2UgLSAxKSAlIHRoaXMuYnV0dG9uc0xpbWl0O1xuICAgICAgICBwYWdpbmF0aW9uQnV0dG9uc1thY3RpdmVCdXR0b25JbmRleF0uY2xhc3NMaXN0LmFkZCgncGFnaW5hdGlvbl9fYnV0dG9uLS1hY3RpdmUnKTtcblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA9PT0gMSkge1xuICAgICAgICAgICAgYnV0dG9uUHJldi5jbGFzc0xpc3QuYWRkKGNsYXNzSW5hY3RpdmUpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudFBhZ2UgPT09IHRoaXMudG90YWxQYWdlcykge1xuICAgICAgICAgICAgYnV0dG9uTmV4dC5jbGFzc0xpc3QuYWRkKGNsYXNzSW5hY3RpdmUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnV0dG9uUHJldi5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzSW5hY3RpdmUpO1xuICAgICAgICAgICAgYnV0dG9uTmV4dC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzSW5hY3RpdmUpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZW51bWJlckJ1dHRvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBhZ2luYXRpb25CdXR0b25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncGFnaW5hdGlvbl9fYnV0dG9uJyksXG4gICAgICAgIGFjdGl2ZUJ1dHRvbkluZGV4ID0gKHRoaXMuY3VycmVudFBhZ2UgLSAxKSAlIHRoaXMuYnV0dG9uc0xpbWl0O1xuXG4gICAgICAgIHZhciBsID0gcGFnaW5hdGlvbkJ1dHRvbnMubGVuZ3RoO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSAhPSBsICsgMSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ25pZSB6YWR6aWFsYW0nKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICAgICAgb2Zmc2V0ID0gTWF0aC5taW4odGhpcy50b3RhbFBhZ2VzIC0gdGhpcy5jdXJyZW50UGFnZSArIDEsIHRoaXMuYnV0dG9uc0xpbWl0KTtcbiAgICAgICAgY29uc29sZS5sb2coJ09GRlNFVDogJyArIG9mZnNldCk7XG5cblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgcGFnaW5hdGlvbkJ1dHRvbnNbaV0udGV4dENvbnRlbnQgPSBwYXJzZUludChwYWdpbmF0aW9uQnV0dG9uc1tpXS5kYXRhc2V0LnBhZ2UpICsgb2Zmc2V0O1xuICAgICAgICB9O1xuXG5cbiAgICB9LFxuICAgIGFkZFBhZ2luYXRpb25MaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBhZ2luYXRpb25CdXR0b25zTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdpbmF0aW9uX19idXR0b25zLWxpc3QnKSxcbiAgICAgICAgYnV0dG9uUHJldiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2J1dHRvbnMtbmV4dC1wcmV2X193cmFwJylbMF0sXG4gICAgICAgIGJ1dHRvbk5leHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdidXR0b25zLW5leHQtcHJldl9fd3JhcCcpWzFdLFxuICAgICAgICB0aGF0ID0gdGhpcztcblxuICAgICAgICBwYWdpbmF0aW9uQnV0dG9uc0xpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdGhhdC5nb1RvUGFnZSh7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFyc2VJbnQoZS50YXJnZXQuZGF0YXNldC5wYWdlKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBidXR0b25QcmV2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHRoYXQuZ29Ub1BhZ2Uoe1xuICAgICAgICAgICAgICAgIG9mZnNldDogLTFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYnV0dG9uTmV4dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB0aGF0LmdvVG9QYWdlKHtcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IDFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG4vKm9wdGlvbnM6IHRlbXBsYXRlSWQsIGRhdGEsIHRhcmdldElkKi9cbmZ1bmN0aW9uIHJlbmRlclZpZXcob3B0aW9ucykge1xuICAgIHZhciBzb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLnRlbXBsYXRlSWQpLnRleHRDb250ZW50LFxuICAgICAgICB0ZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpLFxuICAgICAgICBjb250ZXh0ID0gb3B0aW9ucy5kYXRhLFxuICAgICAgICB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLnRhcmdldElkKSxcbiAgICAgICAgaHRtbCA9IHRlbXBsYXRlKGNvbnRleHQpO1xuXG4gICAgdGFyZ2V0LmlubmVySFRNTCA9IGh0bWw7XG59XG5cbm9mZmVyc0xpc3QuaW5pdCgpO1xuXG5cblxuLyp9OyovXG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3RpbWVzJywgZnVuY3Rpb24gKG51bWJlciwgZWxlbWVudCkge1xuICAgICAgICB2YXIgYXJyID0gbmV3IEFycmF5KG51bWJlciArIDEpLFxuICAgICAgICByZXN1bHQgPSBhcnIuam9pbihlbGVtZW50KTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuXG4gICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaW5jcmVhc2UnLCBmdW5jdGlvbiAodmFsdWUsIHN0ZXApIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlICsgc3RlcDtcbiAgICB9KTtcblxuXG4gICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2NvcmVEZXNjcmlwdGlvbicsIGZ1bmN0aW9uIChzY29yZSkge1xuICAgICAgICB2YXIgZGVzY3JpcHRpb24gPSAnJztcblxuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2UgKHNjb3JlIDw9IDMpOlxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ0ZhdGFsbnknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAoc2NvcmUgPiAzICYmIHNjb3JlIDw9IDUpOlxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ05pZSBuYWpsZXBzenknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAoc2NvcmUgPiA1ICYmIHNjb3JlIDwgNi40KTpcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdQcnplY2nEmXRueSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIChzY29yZSA+IDUgJiYgc2NvcmUgPD0gNi41KTpcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdQcnplY2nEmXRueSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIChzY29yZSA+IDYuNSAmJiBzY29yZSA8PSA4KTpcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdCYXJkem8gZG9icnknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAoc2NvcmUgPiA4ICYmIHNjb3JlIDwgOSk6XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnWm5ha29taXR5JztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnV3liaXRueSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGVzY3JpcHRpb24gKyAnICcgKyBzY29yZTtcbiAgICB9KTtcblxuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lzRXF1YWwnLCBmdW5jdGlvbiAocHJpY2VSZWd1bGFyLCBwcmljZVByb21vKSB7XG4gICAgICAgIHJldHVybiBwcmljZVJlZ3VsYXIgPT09IHByaWNlUHJvbW87XG4gICAgfSk7XG59KSgpO1xuXG4iLCIoZnVuY3Rpb24gKCkge1xuJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBvZmZlcnNEYXRhLCBvZmZlcnNWaWV3LCBvZmZlcnNTdGF0ZTtcblxuICAgIG9mZmVyc0RhdGEgPSB7XG4gICAgICAgIGJhc2VVcmw6ICcvL2NhbXAuZWZpZ2VuY2UuY29tL2NhbXAvYXBpL3BsYWNlcz9wYWdlPScsXG4gICAgICAgIGdldERhdGE6IGZ1bmN0aW9uIChwYWdlTnVtYmVyKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIHVybDogdGhhdC5iYXNlVXJsICsgcGFnZU51bWJlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgb2ZmZXJzU3RhdGUgPSB7XG4gICAgICAgIHRvdGFsUGFnZXM6IG51bGwsXG4gICAgICAgIGN1cnJlbnRQYWdlOiAxLFxuICAgICAgICBtYXhOdW1iZXJPZkJ1dHRvbnM6IDEwLFxuICAgICAgICBudW1iZXJPZlZpc2libGVCdXR0b25zOiBudWxsLFxuICAgICAgICB2aXNpYmxlUGFnZXM6IFtdLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIG9mZmVyc0RhdGEuZ2V0RGF0YSgpXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC50b3RhbFBhZ2VzID0gZGF0YS50b3RhbF9wYWdlcztcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5udW1iZXJPZlZpc2libGVCdXR0b25zID0gTWF0aC5taW4odGhhdC50b3RhbFBhZ2VzLCB0aGF0Lm1heE51bWJlck9mQnV0dG9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGF0Lm51bWJlck9mVmlzaWJsZUJ1dHRvbnM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC52aXNpYmxlUGFnZXMucHVzaChpICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBvZmZlcnNWaWV3LnVwZGF0ZVZpZXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZU51bWJlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUJ1dHRvbkluZGV4OiAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBvZmZlcnNWaWV3LnJlbmRlclBhZ2luYXRpb24odGhhdC5udW1iZXJPZlZpc2libGVCdXR0b25zKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5hZGRMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlVmlzaWJsZVBhZ2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uc0NvdW50ID0gdGhpcy5udW1iZXJPZlZpc2libGVCdXR0b25zLFxuICAgICAgICAgICAgYnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BhZ2luYXRpb25fX2J1dHRvbicpLFxuICAgICAgICAgICAgb2Zmc2V0O1xuXG4gICAgICAgICAgICBpZiAodGhpcy52aXNpYmxlUGFnZXMuaW5kZXhPZih0aGlzLmN1cnJlbnRQYWdlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy52aXNpYmxlUGFnZXNbMF0gPiB0aGlzLmN1cnJlbnRQYWdlKSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gTWF0aC5tYXgoLXRoaXMuY3VycmVudFBhZ2UsIC1idXR0b25zQ291bnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBNYXRoLm1pbihidXR0b25zQ291bnQsIHRoaXMudG90YWxQYWdlcyAtIHRoaXMuY3VycmVudFBhZ2UgKyAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBidXR0b25zQ291bnQ7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGVQYWdlc1tpXSA9IHRoaXMudmlzaWJsZVBhZ2VzW2ldICsgb2Zmc2V0O1xuICAgICAgICAgICAgICAgIGJ1dHRvbnNbaV0udGV4dENvbnRlbnQgPSB0aGlzLnZpc2libGVQYWdlc1tpXTtcbiAgICAgICAgICAgICAgICBidXR0b25zW2ldLmRhdGFzZXQucGFnZSA9IHRoaXMudmlzaWJsZVBhZ2VzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVTdGF0dXM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0UGFnZSwgYWN0aXZlQnV0dG9uO1xuXG4gICAgICAgICAgICBpZiAoKG9wdGlvbnMucGFnZSAmJiBvcHRpb25zLm9mZnNldCkgfHwgKCFvcHRpb25zLnBhZ2UgJiYgIW9wdGlvbnMub2Zmc2V0KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhcmdldFBhZ2UgPSBvcHRpb25zLnBhZ2UgfHwgdGhpcy5jdXJyZW50UGFnZSArIG9wdGlvbnMub2Zmc2V0O1xuICAgICAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAodGFyZ2V0UGFnZSA9PT0gdGhpcy5jdXJyZW50UGFnZSk6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBjYXNlICh0YXJnZXRQYWdlID4gdGhpcy50b3RhbFBhZ2VzKTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGNhc2UgKHRhcmdldFBhZ2UgPCAxKTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0YXJnZXRQYWdlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZpc2libGVQYWdlcygpO1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmVCdXR0b24gPSB0aGlzLnZpc2libGVQYWdlcy5pbmRleE9mKHRhcmdldFBhZ2UpO1xuICAgICAgICAgICAgICAgICAgICBvZmZlcnNWaWV3LnVwZGF0ZVZpZXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZU51bWJlcjogdGFyZ2V0UGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUJ1dHRvbkluZGV4OiBhY3RpdmVCdXR0b24sXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFBhZ2VzOiB0aGlzLnRvdGFsUGFnZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhZGRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwYWdpbmF0aW9uQnV0dG9uc0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnaW5hdGlvbl9fYnV0dG9ucy1saXN0JyksXG4gICAgICAgICAgICBidXR0b25QcmV2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYnV0dG9ucy1uZXh0LXByZXZfX3dyYXAnKVswXSxcbiAgICAgICAgICAgIGJ1dHRvbk5leHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdidXR0b25zLW5leHQtcHJldl9fd3JhcCcpWzFdLFxuICAgICAgICAgICAgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHBhZ2luYXRpb25CdXR0b25zTGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51cGRhdGVTdGF0dXMoe1xuICAgICAgICAgICAgICAgICAgICBwYWdlOiBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LnBhZ2UpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJ1dHRvblByZXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHRoYXQudXBkYXRlU3RhdHVzKHtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAtMVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBidXR0b25OZXh0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVwZGF0ZVN0YXR1cyh7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDogMVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgb2ZmZXJzVmlldyA9IHtcbiAgICAgICAgcmVuZGVyVGVtcGxhdGU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgc291cmNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy50ZW1wbGF0ZUlkKS50ZXh0Q29udGVudCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpLFxuICAgICAgICAgICAgICAgIGNvbnRleHQgPSBvcHRpb25zLmRhdGEsXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy50YXJnZXRJZCksXG4gICAgICAgICAgICAgICAgaHRtbCA9IHRlbXBsYXRlKGNvbnRleHQpO1xuXG4gICAgICAgICAgICB0YXJnZXQuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyT2ZmZXJzTGlzdDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlSWQ6ICdvZmZlcnMtdGVtcGxhdGUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgdGFyZ2V0SWQ6ICdvZmZlcnMnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyT2ZmZXJzRXJyb3I6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUlkOiAnb2ZmZXJzLXRlbXBsYXRlLS1lcnJvcicsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogJ29mZmVycydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICByZW5kZXJQYWdpbmF0aW9uOiBmdW5jdGlvbiAoYnV0dG9uc0NvdW50KSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uc05leHRQcmV2LCB0ZW1wbGF0ZUFycmF5O1xuXG4gICAgICAgICAgICBidXR0b25zTmV4dFByZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdidXR0b25zLW5leHQtcHJldl9fd3JhcCcpO1xuICAgICAgICAgICAgdGVtcGxhdGVBcnJheSA9IEFycmF5LmFwcGx5KG51bGwsIG5ldyBBcnJheShidXR0b25zQ291bnQpKS5tYXAoTnVtYmVyLnByb3RvdHlwZS52YWx1ZU9mLCAwKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgICAgICAgICBidXR0b25zTmV4dFByZXZbaV0uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlSWQ6ICdwYWdpbmF0aW9uLWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge2J1dHRvbnNDb3VudDogdGVtcGxhdGVBcnJheX0sXG4gICAgICAgICAgICAgICAgdGFyZ2V0SWQ6ICdwYWdpbmF0aW9uX19idXR0b25zLWxpc3QnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlVmlldzogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIG9mZmVyc0RhdGEuZ2V0RGF0YShvcHRpb25zLnBhZ2VOdW1iZXIpXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5yZW5kZXJPZmZlcnNMaXN0KGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1hcmtBY3RpdmVCdXR0b24ob3B0aW9ucy5hY3RpdmVCdXR0b25JbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd0hpZGVOYXZCdXR0b25zKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucmVuZmVyT2ZmZXJzRXJyb3IoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG1hcmtBY3RpdmVCdXR0b246IGZ1bmN0aW9uIChidXR0b25JbmRleCkge1xuICAgICAgICAgICAgdmFyIGNsYXNzQWN0aXZlID0gJ3BhZ2luYXRpb25fX2J1dHRvbi0tYWN0aXZlJyxcbiAgICAgICAgICAgIGJ1dHRvbnNBY3RpdmUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzQWN0aXZlKSxcbiAgICAgICAgICAgIGJ1dHRvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYWdpbmF0aW9uX19idXR0b24nKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBidXR0b25zQWN0aXZlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnNBY3RpdmVbaV0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc0FjdGl2ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJ1dHRvbnNbYnV0dG9uSW5kZXhdLmNsYXNzTGlzdC5hZGQoY2xhc3NBY3RpdmUpO1xuICAgICAgICB9LFxuICAgICAgICBzaG93SGlkZU5hdkJ1dHRvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uc05leHRQcmV2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYnV0dG9ucy1uZXh0LXByZXZfX3dyYXAnKSxcbiAgICAgICAgICAgIGNsYXNzSW5hY3RpdmUgPSAnYnV0dG9ucy1uZXh0LXByZXZfX3dyYXAtLWluYWN0aXZlJyxcbiAgICAgICAgICAgIGJ1dHRvbnNOZXhQcmV2SW5hY3RpdmUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzSW5hY3RpdmUpO1xuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wYWdlTnVtYmVyID4gMSAmJiBvcHRpb25zLnBhZ2VOdW1iZXIgPCBvcHRpb25zLnRvdGFsUGFnZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGJ1dHRvbnNOZXhQcmV2SW5hY3RpdmUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbnNOZXhQcmV2SW5hY3RpdmVbaV0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc0luYWN0aXZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMucGFnZU51bWJlciA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnNOZXh0UHJldlswXS5jbGFzc0xpc3QuYWRkKGNsYXNzSW5hY3RpdmUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b25zTmV4dFByZXZbMV0uY2xhc3NMaXN0LmFkZChjbGFzc0luYWN0aXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbm9mZmVyc1N0YXRlLmluaXQoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIHZhciBidG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGFtYnVyZ2VyLWJ1dHRvbicpLFxuICAgIG1haW5NZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4tbWVudScpLFxuICAgIGNvbGxhcHNlQ2xhc3MgPSAnbWFpbi1tZW51LS1jb2xsYXBzZWQnLFxuICAgIGFuaW1hdGlvbkV4cGFuZCA9ICdhbmltYXRlZC0tc2NhbGVJbic7XG4gICAgYW5pbWF0aW9uQ29sbGFwc2UgPSAnYW5pbWF0ZWQtLXNjYWxlT3V0JyxcbiAgICBhbmltYXRpb25EZWxheSA9IDMwMDtcblxuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKG1haW5NZW51LmNsYXNzTGlzdC5jb250YWlucyhjb2xsYXBzZUNsYXNzKSkge1xuICAgICAgICAgICAgbWFpbk1lbnUuY2xhc3NMaXN0LnRvZ2dsZShjb2xsYXBzZUNsYXNzKTtcbiAgICAgICAgICAgIG1haW5NZW51LmNsYXNzTGlzdC50b2dnbGUoYW5pbWF0aW9uRXhwYW5kKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1haW5NZW51LmNsYXNzTGlzdC50b2dnbGUoYW5pbWF0aW9uRXhwYW5kKTtcbiAgICAgICAgICAgIG1haW5NZW51LmNsYXNzTGlzdC50b2dnbGUoYW5pbWF0aW9uQ29sbGFwc2UpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbWFpbk1lbnUuY2xhc3NMaXN0LnRvZ2dsZShjb2xsYXBzZUNsYXNzKTtcbiAgICAgICAgICAgICAgICBtYWluTWVudS5jbGFzc0xpc3QudG9nZ2xlKGFuaW1hdGlvbkNvbGxhcHNlKTtcbiAgICAgICAgICAgIH0sIGFuaW1hdGlvbkRlbGF5KTtcbiAgICAgICAgfVxuICAgICAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZSgnZmEtYmFycycpO1xuICAgICAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZSgnZmEtdGltZXMnKTtcbiAgICB9KVxufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==